<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's for Dinner - Recipe Fusion Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --dark-bg: #1a1a2e;
            --card-bg: #16213e;
            --text-primary: #f5f5f5;
            --text-secondary: #b8b8b8;
            --accent: #e94560;
            --fusion-gradient: linear-gradient(45deg, #ff6b6b, #4ecdc4, #e94560);
            --suggested-gradient: linear-gradient(45deg, #f39c12, #e67e22);
            --protein-color: #4CAF50;
            --carbs-color: #FF9800;
            --fat-color: #F44336;
            --calories-color: #9C27B0;
            --premium-color: #FFD700;
            --blur-filter: blur(8px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Landing Page Styles */
        .landing-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--card-bg) 100%);
        }

        .landing-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .landing-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .landing-logo i {
            font-size: 3rem;
            background: var(--fusion-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .landing-logo h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--fusion-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .landing-subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .landing-description {
            color: var(--text-secondary);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .auth-type-selector {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .auth-type-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            width: 300px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .auth-type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        }

        .auth-type-card.active {
            border: 2px solid var(--secondary-color);
        }

        .auth-type-card i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .auth-type-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .auth-type-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .auth-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 450px;
            overflow: hidden;
        }

        .auth-tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .auth-tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .auth-forms {
            padding: 2rem;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
        }

        .form-error {
            color: var(--accent);
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
        }

        .btn-primary {
            background: var(--fusion-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.4);
        }

        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .auth-footer {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .auth-footer a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        .return-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .return-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background-color: var(--card-bg);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left: 4px solid var(--accent);
        }

        .notification.success {
            border-left: 4px solid var(--secondary-color);
        }

        .notification.info {
            border-left: 4px solid var(--primary-color);
        }

        /* Main App Styles (hidden by default) */
        .main-app {
            display: none;
        }

        /* Admin App Styles (hidden by default) */
        .admin-app {
            display: none;
        }

        header {
            background-color: var(--card-bg);
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo i {
            font-size: 2rem;
            background: var(--fusion-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--fusion-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-icon {
            position: relative;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .header-icon:hover {
            color: var(--text-primary);
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--accent);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Dropdown Styles */
        .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .dropdown-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
        }

        .dropdown-content {
            padding: 0.5rem 0;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .item-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .item-content {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .item-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .dropdown-empty {
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        /* Subscription Dropdown */
        .subscription-dropdown {
            width: 400px;
            max-height: 500px;
        }

        .current-plan-info {
            background-color: rgba(78, 205, 196, 0.1);
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-plan-details {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .current-plan-details i {
            color: var(--secondary-color);
            font-size: 1.5rem;
        }

        .current-plan-details h3 {
            margin-bottom: 0.25rem;
        }

        .current-plan-details p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .subscription-plans {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .subscription-plan {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .subscription-plan:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .subscription-plan.featured {
            border: 2px solid var(--premium-color);
        }

        .subscription-plan.featured::before {
            content: 'POPULAR';
            position: absolute;
            top: 10px;
            right: -30px;
            background-color: var(--premium-color);
            color: var(--dark-bg);
            font-weight: 600;
            padding: 0.25rem 3rem;
            transform: rotate(45deg);
            font-size: 0.7rem;
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .plan-name {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .plan-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--premium-color);
        }

        .plan-duration {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .plan-features {
            margin-bottom: 1rem;
        }

        .plan-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .plan-feature i {
            color: var(--secondary-color);
        }

        .btn-subscribe {
            background: var(--premium-gradient);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-subscribe:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
        }

        .btn-subscribe:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--fusion-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-name {
            font-weight: 500;
        }

        .btn-logout {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-logout:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .fusion-badge {
            display: inline-flex;
            align-items: center;
            background: var(--fusion-gradient);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        main {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .search-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .search-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-title i {
            color: var(--secondary-color);
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .custom-select {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .select-trigger {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .select-trigger:hover {
            border-color: rgba(78, 205, 196, 0.5);
        }

        .select-trigger:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
        }

        .select-trigger i {
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .custom-select.open .select-trigger i {
            transform: rotate(180deg);
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 0.5rem;
            background-color: #1f2937;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .custom-select.open .select-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .select-option {
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .select-option:hover {
            background-color: rgba(78, 205, 196, 0.2);
        }

        .select-option.selected {
            background-color: rgba(78, 205, 196, 0.3);
            font-weight: 500;
        }

        .fusion-option {
            background: var(--fusion-gradient);
            color: white;
            font-weight: 500;
        }

        .form-group select {
            display: none; /* Hide original select element */
        }

        .form-actions {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--secondary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            margin-top: 2rem;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .results-title i {
            color: var(--primary-color);
        }

        .results-count {
            background-color: rgba(78, 205, 196, 0.2);
            color: var(--secondary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .recipe-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        }

        .recipe-card.blurred {
            position: relative;
        }

        .recipe-card.blurred::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: var(--blur-filter);
            z-index: 1;
            border-radius: 12px;
        }

        .recipe-card.blurred::after {
            content: 'Premium Recipe';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--premium-color);
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        .recipe-image-container {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .recipe-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .recipe-image.loaded {
            opacity: 1;
        }

        .image-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .image-placeholder i {
            font-size: 2rem;
        }

        .recipe-content {
            padding: 1.5rem;
        }

        .recipe-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .recipe-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .recipe-category, .recipe-area {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .fusion-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--fusion-gradient);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .suggested-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--suggested-gradient);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .suggestion-note {
            background-color: rgba(243, 156, 18, 0.1);
            border-left: 4px solid #f39c12;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .suggestion-note i {
            color: #f39c12;
            font-size: 1.2rem;
        }

        /* Recipe Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            position: relative;
            height: 250px;
            overflow: hidden;
        }

        .modal-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .modal-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Nutrition Badge Styles */
        .nutrition-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(156, 39, 176, 0.1);
            border: 1px solid rgba(156, 39, 176, 0.3);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .nutrition-badge i {
            color: var(--calories-color);
            font-size: 1rem;
        }

        .nutrition-info {
            display: flex;
            align-items: baseline;
            gap: 0.25rem;
        }

        .calories-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--calories-color);
        }

        .calories-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .nutrition-details {
            display: flex;
            gap: 1rem;
            margin-top: 0.25rem;
        }

        .nutrition-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
        }

        .nutrition-item.protein {
            color: var(--protein-color);
        }

        .nutrition-item.carbs {
            color: var(--carbs-color);
        }

        .nutrition-item.fat {
            color: var(--fat-color);
        }

        .recipe-details {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .recipe-section {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ingredients-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.5rem;
        }

        .ingredient-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .ingredient-item i {
            color: var(--primary-color);
            font-size: 0.8rem;
        }

        .instructions-list {
            counter-reset: step-counter;
        }

        .instruction-step {
            position: relative;
            padding-left: 2.5rem;
            margin-bottom: 1rem;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .instruction-step::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 1.8rem;
            height: 1.8rem;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
        }

        /* Nutrition Summary Section */
        .nutrition-summary {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(76, 175, 80, 0.1));
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .nutrition-summary-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nutrition-summary-title i {
            color: var(--calories-color);
        }

        .nutrition-macros {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .macro-item {
            text-align: center;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .macro-value {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .macro-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .macro-item.calories .macro-value {
            color: var(--calories-color);
        }

        .macro-item.protein .macro-value {
            color: var(--protein-color);
        }

        .macro-item.carbs .macro-value {
            color: var(--carbs-color);
        }

        .macro-item.fat .macro-value {
            color: var(--fat-color);
        }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .admin-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .admin-section-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-section-title i {
            color: var(--secondary-color);
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .admin-tab:hover {
            color: var(--text-primary);
        }

        .admin-tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .recipe-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group.half-width {
            grid-column: span 1;
        }

        .ingredients-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .ingredient-row {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .ingredient-row input {
            flex: 1;
        }

        .btn-remove {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-remove:hover {
            background-color: #d63851;
        }

        .btn-add {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }

        .btn-add:hover {
            background-color: #3bb5ac;
        }

        .category-list, .area-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .category-item, .area-item {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-item i, .area-item i {
            color: var(--primary-color);
        }

        .message-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message-form textarea {
            min-height: 150px;
            resize: vertical;
        }

        .message-list {
            margin-top: 2rem;
        }

        .message-item {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-content {
            flex: 1;
        }

        .message-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .message-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .message-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-left: 1rem;
        }

        .btn-delete {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background-color: #d63851;
        }

        footer {
            background-color: var(--card-bg);
            padding: 1.5rem 2rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }

            .recipe-grid {
                grid-template-columns: 1fr;
            }

            .ingredients-list {
                grid-template-columns: 1fr;
            }

            .nutrition-macros {
                grid-template-columns: repeat(2, 1fr);
            }

            .recipe-form {
                grid-template-columns: 1fr;
            }

            .form-group.half-width {
                grid-column: span 1;
            }

            .modal-content {
                width: 95%;
                max-height: 95vh;
            }

            .subscription-dropdown {
                width: 300px;
            }

            .auth-type-selector {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing-container" id="landingPage">
        <div class="landing-header">
            <div class="landing-logo">
                <i class="fas fa-utensils"></i>
                <h1>What's for Dinner</h1>
            </div>
            <div class="landing-subtitle">Recipe Fusion Engine</div>
            <p class="landing-description">Discover unique fusion recipes by combining different cuisines and categories. Create culinary masterpieces with our intelligent recipe fusion engine.</p>
        </div>

        <div class="auth-type-selector">
            <div class="auth-type-card active" id="userTypeCard">
                <i class="fas fa-user"></i>
                <h3>User</h3>
                <p>Explore recipes and find your perfect fusion dish</p>
            </div>
            <div class="auth-type-card" id="adminTypeCard">
                <i class="fas fa-user-shield"></i>
                <h3>Admin</h3>
                <p>Manage recipes, categories, and send messages to users</p>
            </div>
        </div>

        <div class="auth-container">
            <div class="auth-tabs">
                <div class="auth-tab active" id="signinTab">Sign In</div>
                <div class="auth-tab" id="registerTab">Register</div>
            </div>

            <div class="auth-forms">
                <!-- Sign In Form -->
                <form class="auth-form active" id="signinForm">
                    <div class="form-group">
                        <label for="signinEmail">Email</label>
                        <input type="email" id="signinEmail" class="form-control" placeholder="Enter your email" required>
                        <div class="form-error" id="signinEmailError">Please enter a valid email</div>
                    </div>
                    <div class="form-group">
                        <label for="signinPassword">Password</label>
                        <input type="password" id="signinPassword" class="form-control" placeholder="Enter your password" required>
                        <div class="form-error" id="signinPasswordError">Password is required</div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="signinBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                </form>

                <!-- Register Form -->
                <form class="auth-form" id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" class="form-control" placeholder="Enter your full name" required>
                        <div class="form-error" id="registerNameError">Name is required</div>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email" required>
                        <div class="form-error" id="registerEmailError">Please enter a valid email</div>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                        <div class="form-error" id="registerPasswordError">Password must be at least 6 characters</div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm your password" required>
                        <div class="form-error" id="confirmPasswordError">Passwords do not match</div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="registerBtn">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                </form>
            </div>

            <div class="auth-footer">
                <span id="authFooterText">Don't have an account? <a href="#" id="authFooterLink">Register</a></span>
            </div>
        </div>

        <button class="return-btn" id="returnBtn" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
    </div>

    <!-- Main User App (hidden by default) -->
    <div class="main-app" id="mainApp">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <div>
                        <h1>What's for Dinner</h1>
                        <div class="subtitle">Recipe Fusion Engine</div>
                    </div>
                </div>
                <div class="user-menu">
                    <div class="header-icon" id="messageBell">
                        <i class="fas fa-bell"></i>
                        <div class="badge" id="messageBadge" style="display: none;">0</div>
                        <div class="dropdown" id="messageDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-title">Messages & Offers</div>
                                <button class="dropdown-close" id="messageDropdownClose">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="dropdown-content" id="messageDropdownContent">
                                <!-- Messages will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                    <div class="header-icon" id="subscriptionBell">
                        <i class="fas fa-crown"></i>
                        <div class="dropdown subscription-dropdown" id="subscriptionDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-title">Subscription Plans</div>
                                <button class="dropdown-close" id="subscriptionDropdownClose">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="dropdown-content">
                                <div class="current-plan-info" id="currentPlan">
                                    <div class="current-plan-details">
                                        <i class="fas fa-gift"></i>
                                        <div>
                                            <h3>Free Plan</h3>
                                            <p>2 recipes per day</p>
                                        </div>
                                    </div>
                                    <div>
                                        <span id="recipesRemaining">2 recipes remaining today</span>
                                    </div>
                                </div>

                                <div class="subscription-plans">
                                    <div class="subscription-plan">
                                        <div class="plan-header">
                                            <div class="plan-name">Starter</div>
                                            <div class="plan-price">â‚¹20</div>
                                        </div>
                                        <div class="plan-duration">Valid for 10 days</div>
                                        <div class="plan-features">
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>10 recipes</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Access to all categories</span>
                                            </div>
                                        </div>
                                        <button class="btn-subscribe" data-plan="starter" data-price="20" data-duration="10">Subscribe</button>
                                    </div>
                                    
                                    <div class="subscription-plan featured">
                                        <div class="plan-header">
                                            <div class="plan-name">Monthly</div>
                                            <div class="plan-price">â‚¹50</div>
                                        </div>
                                        <div class="plan-duration">1 month</div>
                                        <div class="plan-features">
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Unlimited recipes</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Access to all categories</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Priority support</span>
                                            </div>
                                        </div>
                                        <button class="btn-subscribe" data-plan="monthly" data-price="50" data-duration="30">Subscribe</button>
                                    </div>
                                    
                                    <div class="subscription-plan">
                                        <div class="plan-header">
                                            <div class="plan-name">Quarterly</div>
                                            <div class="plan-price">â‚¹120</div>
                                        </div>
                                        <div class="plan-duration">3 months</div>
                                        <div class="plan-features">
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Unlimited recipes</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Access to all categories</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Save 20%</span>
                                            </div>
                                        </div>
                                        <button class="btn-subscribe" data-plan="quarterly" data-price="120" data-duration="90">Subscribe</button>
                                    </div>
                                    
                                    <div class="subscription-plan">
                                        <div class="plan-header">
                                            <div class="plan-name">Half Yearly</div>
                                            <div class="plan-price">â‚¹200</div>
                                        </div>
                                        <div class="plan-duration">6 months</div>
                                        <div class="plan-features">
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Unlimited recipes</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Access to all categories</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Save 33%</span>
                                            </div>
                                        </div>
                                        <button class="btn-subscribe" data-plan="halfyearly" data-price="200" data-duration="180">Subscribe</button>
                                    </div>
                                    
                                    <div class="subscription-plan">
                                        <div class="plan-header">
                                            <div class="plan-name">Annual</div>
                                            <div class="plan-price">â‚¹450</div>
                                        </div>
                                        <div class="plan-duration">12 months + 1 month free</div>
                                        <div class="plan-features">
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Unlimited recipes</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Access to all categories</span>
                                            </div>
                                            <div class="plan-feature">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Save 25% + 1 month free</span>
                                            </div>
                                        </div>
                                        <button class="btn-subscribe" data-plan="annual" data-price="450" data-duration="390">Subscribe</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-name" id="userName">User</div>
                    </div>
                    <button class="btn btn-logout" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <main>
            <!-- Search Section -->
            <section class="search-section">
                <h2 class="search-title">
                    <i class="fas fa-search"></i>
                    Find Your Fusion Recipe
                    <span class="fusion-badge">Fusion Engine</span>
                </h2>
                <form class="search-form" id="searchForm">
                    <div class="form-group">
                        <label for="category">Recipe Category</label>
                        <div class="custom-select" id="categorySelect">
                            <select id="category" required>
                                <option value="">Select a category</option>
                            </select>
                            <div class="select-trigger">
                                <span>Select a category</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option" data-value="">Select a category</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="area">Area/Cuisine</label>
                        <div class="custom-select" id="areaSelect">
                            <select id="area" required>
                                <option value="">Select a cuisine</option>
                            </select>
                            <div class="select-trigger">
                                <span>Select a cuisine</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option" data-value="">Select a cuisine</div>
                                <div class="select-option fusion-option" data-value="fusion">
                                    <i class="fas fa-fire"></i>
                                    Fusion Mix (All Cuisines)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="searchBtn">
                            <i class="fas fa-search"></i>
                            Find Fusion Recipes
                        </button>
                    </div>
                </form>
            </section>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Finding your fusion recipes...</p>
            </div>

            <section class="results-section" id="resultsSection" style="display: none;">
                <div class="suggestion-note" id="suggestionNote" style="display: none;">
                    <i class="fas fa-lightbulb"></i>
                    <div>
                        <strong>Suggested Fusion:</strong> No direct matches found, but here are recipes that can inspire your fusion creation!
                    </div>
                </div>
                <div class="results-header">
                    <h2 class="results-title">
                        <i class="fas fa-book-open"></i>
                        Fusion Recipes
                    </h2>
                    <div class="results-count" id="resultsCount">0 recipes found</div>
                </div>
                <div class="recipe-grid" id="recipeGrid">
                    <!-- Recipes will be dynamically added here -->
                </div>
            </section>
        </main>

        <footer>
            <p>Â© 2023 Recipe Fusion Engine | Powered by Admin Recipe Management</p>
        </footer>
    </div>

    <!-- Recipe Modal -->
    <div class="modal" id="recipeModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <img id="modalRecipeImage" src="" alt="">
            </div>
            <div class="modal-body">
                <h2 class="modal-title" id="modalRecipeTitle"></h2>
                <div class="modal-meta">
                    <div class="recipe-category">
                        <i class="fas fa-tag"></i>
                        <span id="modalRecipeCategory"></span>
                    </div>
                    <div class="recipe-area">
                        <i class="fas fa-globe"></i>
                        <span id="modalRecipeArea"></span>
                    </div>
                </div>
                
                <!-- Nutrition Badge -->
                <div class="nutrition-badge">
                    <i class="fas fa-fire"></i>
                    <div class="nutrition-info">
                        <span class="calories-value" id="modalCaloriesValue"></span>
                        <span class="calories-label">cal</span>
                    </div>
                    <div class="nutrition-details">
                        <div class="nutrition-item protein">
                            <i class="fas fa-drumstick-bite"></i>
                            <span id="modalProteinValue"></span>g
                        </div>
                        <div class="nutrition-item carbs">
                            <i class="fas fa-bread-slice"></i>
                            <span id="modalCarbsValue"></span>g
                        </div>
                        <div class="nutrition-item fat">
                            <i class="fas fa-cheese"></i>
                            <span id="modalFatValue"></span>g
                        </div>
                    </div>
                </div>
                
                <div class="recipe-details">
                    <div class="nutrition-summary" id="modalNutritionSummary">
                        <!-- Nutrition summary will be added here -->
                    </div>
                    
                    <div class="recipe-section">
                        <h3 class="section-title">
                            <i class="fas fa-list"></i>
                            Ingredients
                        </h3>
                        <div class="ingredients-list" id="modalIngredientsList">
                            <!-- Ingredients will be added here -->
                        </div>
                    </div>
                    <div class="recipe-section">
                        <h3 class="section-title">
                            <i class="fas fa-tasks"></i>
                            Instructions
                        </h3>
                        <div class="instructions-list" id="modalInstructionsList">
                            <!-- Instructions will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin App (hidden by default) -->
    <div class="admin-app" id="adminApp">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <div>
                        <h1>What's for Dinner</h1>
                        <div class="subtitle">Admin Dashboard</div>
                    </div>
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <div class="user-avatar" id="adminAvatar">A</div>
                        <div class="user-name" id="adminName">Admin</div>
                    </div>
                    <button class="btn btn-logout" id="adminLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <main>
            <div class="admin-dashboard">
                <div class="admin-section">
                    <h2 class="admin-section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Admin Dashboard
                    </h2>
                    
                    <div class="admin-tabs">
                        <div class="admin-tab active" data-tab="recipes">Recipes</div>
                        <div class="admin-tab" data-tab="categories">Categories</div>
                        <div class="admin-tab" data-tab="areas">Cuisines</div>
                        <div class="admin-tab" data-tab="messages">Messages</div>
                    </div>
                    
                    <!-- Recipes Tab -->
                    <div class="admin-tab-content active" id="recipes-tab">
                        <h3>Add New Recipe</h3>
                        <form class="recipe-form" id="recipeForm">
                            <div class="form-group full-width">
                                <label for="recipeName">Recipe Name</label>
                                <input type="text" id="recipeName" class="form-control" placeholder="Enter recipe name" required>
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="recipeCategory">Category</label>
                                <select id="recipeCategory" class="form-control" required>
                                    <option value="">Select a category</option>
                                </select>
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="recipeArea">Cuisine</label>
                                <select id="recipeArea" class="form-control" required>
                                    <option value="">Select a cuisine</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="recipeImage">Image URL</label>
                                <input type="text" id="recipeImage" class="form-control" placeholder="Enter image URL">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="recipeInstructions">Instructions</label>
                                <textarea id="recipeInstructions" class="form-control" rows="5" placeholder="Enter cooking instructions" required></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label>Ingredients</label>
                                <div class="ingredients-container" id="ingredientsContainer">
                                    <div class="ingredient-row">
                                        <input type="text" class="form-control ingredient-name" placeholder="Ingredient name">
                                        <input type="text" class="form-control ingredient-measure" placeholder="Measure">
                                        <button type="button" class="btn-remove"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <button type="button" class="btn-add" id="addIngredientBtn">
                                    <i class="fas fa-plus"></i>
                                    Add Ingredient
                                </button>
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="recipeCalories">Calories</label>
                                <input type="number" id="recipeCalories" class="form-control" placeholder="Enter calories">
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="recipeProtein">Protein (g)</label>
                                <input type="number" id="recipeProtein" class="form-control" placeholder="Enter protein">
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="recipeCarbs">Carbs (g)</label>
                                <input type="number" id="recipeCarbs" class="form-control" placeholder="Enter carbs">
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="recipeFat">Fat (g)</label>
                                <input type="number" id="recipeFat" class="form-control" placeholder="Enter fat">
                            </div>
                            
                            <div class="form-group full-width">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Recipe
                                </button>
                            </div>
                        </form>
                        
                        <h3 style="margin-top: 2rem;">Existing Recipes</h3>
                        <div id="recipesList">
                            <!-- Recipes will be dynamically added here -->
                        </div>
                    </div>
                    
                    <!-- Categories Tab -->
                    <div class="admin-tab-content" id="categories-tab">
                        <h3>Manage Categories</h3>
                        <form id="categoryForm">
                            <div class="form-group">
                                <label for="newCategory">New Category</label>
                                <input type="text" id="newCategory" class="form-control" placeholder="Enter category name" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Add Category
                            </button>
                        </form>
                        
                        <h3 style="margin-top: 2rem;">Existing Categories</h3>
                        <div class="category-list" id="categoryList">
                            <!-- Categories will be dynamically added here -->
                        </div>
                    </div>
                    
                    <!-- Areas Tab -->
                    <div class="admin-tab-content" id="areas-tab">
                        <h3>Manage Cuisines</h3>
                        <form id="areaForm">
                            <div class="form-group">
                                <label for="newArea">New Cuisine</label>
                                <input type="text" id="newArea" class="form-control" placeholder="Enter cuisine name" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Add Cuisine
                            </button>
                        </form>
                        
                        <h3 style="margin-top: 2rem;">Existing Cuisines</h3>
                        <div class="area-list" id="areaList">
                            <!-- Areas will be dynamically added here -->
                        </div>
                    </div>
                    
                    <!-- Messages Tab -->
                    <div class="admin-tab-content" id="messages-tab">
                        <h3>Send Message to Users</h3>
                        <form class="message-form" id="messageForm">
                            <div class="form-group">
                                <label for="messageTitle">Message Title</label>
                                <input type="text" id="messageTitle" class="form-control" placeholder="Enter message title" required>
                            </div>
                            <div class="form-group">
                                <label for="messageContent">Message Content</label>
                                <textarea id="messageContent" class="form-control" rows="5" placeholder="Enter message content" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i>
                                Send Message
                            </button>
                        </form>
                        
                        <h3 style="margin-top: 2rem;">Sent Messages</h3>
                        <div class="message-list" id="messageList">
                            <!-- Messages will be dynamically added here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Â© 2023 Recipe Fusion Engine | Admin Dashboard</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notificationText"></span>
    </div>

    <script>
        // Nutrition Calculator for estimating calories and macros
        class NutritionCalculator {
            constructor() {
                // Database of common ingredients with their nutritional values (per 100g)
                this.ingredientDatabase = {
                    // Proteins
                    'chicken': { calories: 165, protein: 31, carbs: 0, fat: 3.6 },
                    'beef': { calories: 250, protein: 26, carbs: 0, fat: 15 },
                    'pork': { calories: 242, protein: 27, carbs: 0, fat: 14 },
                    'fish': { calories: 206, protein: 22, carbs: 0, fat: 12 },
                    'salmon': { calories: 208, protein: 20, carbs: 0, fat: 13 },
                    'tuna': { calories: 144, protein: 30, carbs: 0, fat: 1 },
                    'shrimp': { calories: 99, protein: 24, carbs: 0.2, fat: 0.3 },
                    'egg': { calories: 155, protein: 13, carbs: 1.1, fat: 11 },
                    'tofu': { calories: 76, protein: 8, carbs: 1.9, fat: 4.8 },
                    'lamb': { calories: 294, protein: 25, carbs: 0, fat: 21 },
                    
                    // Carbs
                    'rice': { calories: 130, protein: 2.7, carbs: 28, fat: 0.3 },
                    'pasta': { calories: 131, protein: 5, carbs: 25, fat: 1.1 },
                    'potato': { calories: 77, protein: 2, carbs: 17, fat: 0.1 },
                    'bread': { calories: 265, protein: 9, carbs: 49, fat: 3.2 },
                    'flour': { calories: 364, protein: 10, carbs: 76, fat: 1 },
                    'noodles': { calories: 138, protein: 5, carbs: 25, fat: 1.8 },
                    'quinoa': { calories: 120, protein: 4.4, carbs: 21, fat: 1.9 },
                    
                    // Vegetables
                    'onion': { calories: 40, protein: 1.1, carbs: 9.3, fat: 0.1 },
                    'garlic': { calories: 149, protein: 6.4, carbs: 33, fat: 0.5 },
                    'tomato': { calories: 18, protein: 0.9, carbs: 3.9, fat: 0.2 },
                    'carrot': { calories: 41, protein: 0.9, carbs: 10, fat: 0.2 },
                    'broccoli': { calories: 34, protein: 2.8, carbs: 7, fat: 0.4 },
                    'spinach': { calories: 23, protein: 2.9, carbs: 3.6, fat: 0.4 },
                    'mushroom': { calories: 22, protein: 3.1, carbs: 3.3, fat: 0.3 },
                    'pepper': { calories: 31, protein: 1, carbs: 7.4, fat: 0.3 },
                    'cucumber': { calories: 16, protein: 0.7, carbs: 3.6, fat: 0.1 },
                    'lettuce': { calories: 15, protein: 1.4, carbs: 2.9, fat: 0.2 },
                    
                    // Fats/Oils
                    'oil': { calories: 884, protein: 0, carbs: 0, fat: 100 },
                    'butter': { calories: 717, protein: 0.9, carbs: 0.1, fat: 81 },
                    'cheese': { calories: 402, protein: 25, carbs: 1.3, fat: 33 },
                    'cream': { calories: 340, protein: 2.8, carbs: 2.9, fat: 37 },
                    'milk': { calories: 42, protein: 3.4, carbs: 5, fat: 1 },
                    'yogurt': { calories: 59, protein: 10, carbs: 3.6, fat: 0.4 },
                    
                    // Legumes
                    'beans': { calories: 347, protein: 21, carbs: 63, fat: 1.2 },
                    'lentils': { calories: 116, protein: 9, carbs: 20, fat: 0.4 },
                    'chickpeas': { calories: 364, protein: 19, carbs: 61, fat: 6 },
                    
                    // Nuts/Seeds
                    'almond': { calories: 579, protein: 21, carbs: 22, fat: 50 },
                    'peanut': { calories: 567, protein: 25, carbs: 16, fat: 49 },
                    'walnut': { calories: 654, protein: 15, carbs: 14, fat: 65 },
                    'sesame': { calories: 573, protein: 17, carbs: 23, fat: 50 },
                    
                    // Others
                    'sugar': { calories: 387, protein: 0, carbs: 100, fat: 0 },
                    'honey': { calories: 304, protein: 0.3, carbs: 82, fat: 0 },
                    'soy sauce': { calories: 60, protein: 10, carbs: 5.6, fat: 0.1 },
                    'ketchup': { calories: 101, protein: 1.1, carbs: 27, fat: 0.2 },
                    'mayonnaise': { calories: 680, protein: 1, carbs: 0.6, fat: 75 }
                };
            }

            // Calculate nutrition based on ingredients
            calculateNutrition(ingredients) {
                let totalCalories = 0;
                let totalProtein = 0;
                let totalCarbs = 0;
                let totalFat = 0;
                let ingredientCount = 0;

                ingredients.forEach(ingredient => {
                    const normalizedIngredient = ingredient.toLowerCase().trim();
                    
                    // Try to find the ingredient in our database
                    let found = false;
                    for (const [key, value] of Object.entries(this.ingredientDatabase)) {
                        if (normalizedIngredient.includes(key)) {
                            // Estimate portion size (default to 100g for main ingredients, less for spices)
                            let portionMultiplier = 1;
                            
                            // Adjust for common measurements
                            if (normalizedIngredient.includes('tbsp') || normalizedIngredient.includes('tablespoon')) {
                                portionMultiplier = 0.15;
                            } else if (normalizedIngredient.includes('tsp') || normalizedIngredient.includes('teaspoon')) {
                                portionMultiplier = 0.05;
                            } else if (normalizedIngredient.includes('cup')) {
                                portionMultiplier = 0.24;
                            } else if (normalizedIngredient.includes('oz') || normalizedIngredient.includes('ounce')) {
                                portionMultiplier = 0.28;
                            } else if (normalizedIngredient.includes('lb') || normalizedIngredient.includes('pound')) {
                                portionMultiplier = 4.5;
                            } else if (normalizedIngredient.includes('clove') || normalizedIngredient.includes('slice')) {
                                portionMultiplier = 0.05;
                            }
                            
                            // Reduce multiplier for spices and seasonings
                            if (key === 'garlic' || key === 'onion' || key === 'pepper' || 
                                normalizedIngredient.includes('powder') || normalizedIngredient.includes('spice') ||
                                normalizedIngredient.includes('sauce') || normalizedIngredient.includes('seasoning')) {
                                portionMultiplier *= 0.3;
                            }
                            
                            totalCalories += value.calories * portionMultiplier;
                            totalProtein += value.protein * portionMultiplier;
                            totalCarbs += value.carbs * portionMultiplier;
                            totalFat += value.fat * portionMultiplier;
                            ingredientCount++;
                            found = true;
                            break;
                        }
                    }
                    
                    // If ingredient not found, estimate based on category
                    if (!found) {
                        let estimatedCalories = 50; // Base estimate
                        
                        // Adjust based on ingredient type
                        if (normalizedIngredient.includes('meat') || normalizedIngredient.includes('chicken') || 
                            normalizedIngredient.includes('beef') || normalizedIngredient.includes('pork')) {
                            estimatedCalories = 150;
                        } else if (normalizedIngredient.includes('vegetable') || normalizedIngredient.includes('veg')) {
                            estimatedCalories = 30;
                        } else if (normalizedIngredient.includes('rice') || normalizedIngredient.includes('pasta') || 
                                   normalizedIngredient.includes('potato')) {
                            estimatedCalories = 120;
                        } else if (normalizedIngredient.includes('oil') || normalizedIngredient.includes('butter') ||
                                   normalizedIngredient.includes('fat')) {
                            estimatedCalories = 200;
                        } else if (normalizedIngredient.includes('sugar') || normalizedIngredient.includes('sweet')) {
                            estimatedCalories = 100;
                        }
                        
                        totalCalories += estimatedCalories;
                        totalProtein += estimatedCalories * 0.15; // 15% protein estimate
                        totalCarbs += estimatedCalories * 0.5; // 50% carbs estimate
                        totalFat += estimatedCalories * 0.35; // 35% fat estimate
                        ingredientCount++;
                    }
                });

                // Round values and ensure minimum values
                totalCalories = Math.max(Math.round(totalCalories), 100);
                totalProtein = Math.max(Math.round(totalProtein), 5);
                totalCarbs = Math.max(Math.round(totalCarbs), 10);
                totalFat = Math.max(Math.round(totalFat), 5);

                return {
                    calories: totalCalories,
                    protein: totalProtein,
                    carbs: totalCarbs,
                    fat: totalFat,
                    ingredientCount: ingredientCount
                };
            }

            // Get health rating based on nutritional balance
            getHealthRating(nutrition) {
                const { calories, protein, carbs, fat } = nutrition;
                
                // Calculate protein percentage
                const proteinCalories = protein * 4;
                const carbCalories = carbs * 4;
                const fatCalories = fat * 9;
                const totalCalculated = proteinCalories + carbCalories + fatCalories;
                
                const proteinPercentage = (proteinCalories / totalCalculated) * 100;
                const carbPercentage = (carbCalories / totalCalculated) * 100;
                const fatPercentage = (fatCalories / totalCalculated) * 100;
                
                // Health scoring
                let score = 0;
                
                // Protein score (higher is better for muscle building)
                if (proteinPercentage >= 25 && proteinPercentage <= 35) score += 30;
                else if (proteinPercentage >= 20 && proteinPercentage < 25) score += 20;
                else if (proteinPercentage >= 15 && proteinPercentage < 20) score += 10;
                
                // Carb score (moderate is good)
                if (carbPercentage >= 40 && carbPercentage <= 50) score += 25;
                else if (carbPercentage >= 30 && carbPercentage < 40) score += 15;
                else if (carbPercentage >= 50 && carbPercentage <= 60) score += 15;
                
                // Fat score (lower is generally better)
                if (fatPercentage >= 20 && fatPercentage <= 30) score += 25;
                else if (fatPercentage >= 15 && fatPercentage < 20) score += 20;
                else if (fatPercentage >= 30 && fatPercentage <= 35) score += 15;
                
                // Calorie score (moderate calories are better)
                if (calories >= 300 && calories <= 600) score += 20;
                else if (calories >= 200 && calories < 300) score += 15;
                else if (calories >= 600 && calories <= 800) score += 10;
                
                return Math.min(score, 100);
            }
        }

        // Authentication Manager
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.currentAdmin = null;
                this.authType = 'user'; // 'user' or 'admin'
                this.init();
            }

            init() {
                // Check if user is already logged in
                const userData = localStorage.getItem('currentUser');
                if (userData) {
                    this.currentUser = JSON.parse(userData);
                    this.authType = 'user';
                    this.showMainApp();
                }
                
                // Check if admin is already logged in
                const adminData = localStorage.getItem('currentAdmin');
                if (adminData) {
                    this.currentAdmin = JSON.parse(adminData);
                    this.authType = 'admin';
                    this.showAdminApp();
                }
            }

            // Register a new user
            register(name, email, password) {
                // Get existing users
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                // Check if email already exists
                if (users.find(user => user.email === email)) {
                    return { success: false, message: 'Email already registered' };
                }
                
                // Add new user
                const newUser = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password, // In a real app, this would be hashed
                    subscription: {
                        plan: 'free',
                        startDate: new Date().toISOString(),
                        endDate: null,
                        recipesViewedToday: 0,
                        lastViewDate: new Date().toDateString()
                    }
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                return { success: true, message: 'Registration successful' };
            }

            // Register a new admin
            registerAdmin(name, email, password) {
                // Get existing admins
                const admins = JSON.parse(localStorage.getItem('admins') || '[]');
                
                // Check if email already exists
                if (admins.find(admin => admin.email === email)) {
                    return { success: false, message: 'Email already registered' };
                }
                
                // Add new admin
                const newAdmin = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password // In a real app, this would be hashed
                };
                
                admins.push(newAdmin);
                localStorage.setItem('admins', JSON.stringify(admins));
                
                return { success: true, message: 'Registration successful' };
            }

            // Sign in user
            signin(email, password) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                // Find user by email
                const user = users.find(user => user.email === email);
                
                if (!user) {
                    return { success: false, message: 'User not found' };
                }
                
                // Check password
                if (user.password !== password) {
                    return { success: false, message: 'Incorrect password' };
                }
                
                // Set current user
                this.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                return { success: true, message: 'Sign in successful' };
            }

            // Sign in admin
            signinAdmin(email, password) {
                const admins = JSON.parse(localStorage.getItem('admins') || '[]');
                
                // Find admin by email
                const admin = admins.find(admin => admin.email === email);
                
                if (!admin) {
                    return { success: false, message: 'Admin not found' };
                }
                
                // Check password
                if (admin.password !== password) {
                    return { success: false, message: 'Incorrect password' };
                }
                
                // Set current admin
                this.currentAdmin = admin;
                localStorage.setItem('currentAdmin', JSON.stringify(admin));
                
                return { success: true, message: 'Sign in successful' };
            }

            // Logout user
            logout() {
                this.currentUser = null;
                localStorage.removeItem('currentUser');
                this.showLandingPage();
            }

            // Logout admin
            logoutAdmin() {
                this.currentAdmin = null;
                localStorage.removeItem('currentAdmin');
                this.showLandingPage();
            }

            // Show main app
            showMainApp() {
                document.getElementById('landingPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('adminApp').style.display = 'none';
                
                // Update user info in header
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.name;
                    document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                    
                    // Update subscription info
                    this.updateSubscriptionInfo();
                }
            }

            // Show admin app
            showAdminApp() {
                document.getElementById('landingPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('adminApp').style.display = 'block';
                
                // Update admin info in header
                if (this.currentAdmin) {
                    document.getElementById('adminName').textContent = this.currentAdmin.name;
                    document.getElementById('adminAvatar').textContent = this.currentAdmin.name.charAt(0).toUpperCase();
                }
            }

            // Show landing page
            showLandingPage() {
                document.getElementById('landingPage').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('adminApp').style.display = 'none';
            }

            // Update subscription info
            updateSubscriptionInfo() {
                if (!this.currentUser) return;
                
                const subscription = this.currentUser.subscription;
                const today = new Date().toDateString();
                
                // Reset daily counter if it's a new day
                if (subscription.lastViewDate !== today) {
                    subscription.recipesViewedToday = 0;
                    subscription.lastViewDate = today;
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                }
                
                // Update UI based on subscription
                const currentPlanElement = document.getElementById('currentPlan');
                const recipesRemainingElement = document.getElementById('recipesRemaining');
                
                if (subscription.plan === 'free') {
                    const remaining = Math.max(0, 2 - subscription.recipesViewedToday);
                    currentPlanElement.querySelector('h3').textContent = 'Free Plan';
                    currentPlanElement.querySelector('p').textContent = '2 recipes per day';
                    recipesRemainingElement.textContent = `${remaining} recipe${remaining !== 1 ? 's' : ''} remaining today`;
                } else {
                    const endDate = new Date(subscription.endDate);
                    const formattedDate = endDate.toLocaleDateString();
                    
                    currentPlanElement.querySelector('h3').textContent = `${subscription.plan.charAt(0).toUpperCase() + subscription.plan.slice(1)} Plan`;
                    currentPlanElement.querySelector('p').textContent = `Valid until ${formattedDate}`;
                    recipesRemainingElement.textContent = 'Unlimited recipes';
                }
            }

            // Check if user can view more recipes
            canViewRecipe() {
                if (!this.currentUser) return false;
                
                const subscription = this.currentUser.subscription;
                
                if (subscription.plan === 'free') {
                    const today = new Date().toDateString();
                    
                    // Reset daily counter if it's a new day
                    if (subscription.lastViewDate !== today) {
                        subscription.recipesViewedToday = 0;
                        subscription.lastViewDate = today;
                        localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    }
                    
                    return subscription.recipesViewedToday < 2;
                } else {
                    // Check if subscription is still valid
                    const now = new Date();
                    const endDate = new Date(subscription.endDate);
                    return now <= endDate;
                }
            }

            // Increment recipe view count
            incrementRecipeView() {
                if (!this.currentUser) return;
                
                const subscription = this.currentUser.subscription;
                
                if (subscription.plan === 'free') {
                    subscription.recipesViewedToday++;
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    this.updateSubscriptionInfo();
                }
            }

            // Subscribe to a plan
            subscribe(plan, price, duration) {
                if (!this.currentUser) return { success: false, message: 'User not logged in' };
                
                const now = new Date();
                const endDate = new Date(now.getTime() + (duration * 24 * 60 * 60 * 1000));
                
                this.currentUser.subscription = {
                    plan: plan,
                    startDate: now.toISOString(),
                    endDate: endDate.toISOString(),
                    recipesViewedToday: 0,
                    lastViewDate: now.toDateString()
                };
                
                localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                this.updateSubscriptionInfo();
                
                return { success: true, message: `Successfully subscribed to ${plan} plan` };
            }
        }

        // Data Management Layer - Using Map for efficient data storage
        class DataManager {
            constructor() {
                this.recipes = new Map(); // Map of recipeId -> recipe details
                this.categoryRecipes = new Map(); // Map of category -> Set of recipeIds
                this.areaRecipes = new Map(); // Map of area -> Set of recipeIds
                this.categories = new Set(); // Set of all categories
                this.areas = new Set(); // Set of all areas
                this.messages = []; // Array of messages
                this.init();
            }

            init() {
                // Load data from localStorage
                this.loadData();
                
                // If no data exists, initialize with sample data
                if (this.recipes.size === 0) {
                    this.initializeSampleData();
                }
            }

            // Load data from localStorage
            loadData() {
                // Load recipes
                const recipesData = localStorage.getItem('recipes');
                if (recipesData) {
                    const recipes = JSON.parse(recipesData);
                    recipes.forEach(recipe => {
                        this.recipes.set(recipe.idMeal, recipe);
                        this.categoryRecipes.set(recipe.strCategory, new Set());
                        this.areaRecipes.set(recipe.strArea, new Set());
                        this.categories.add(recipe.strCategory);
                        this.areas.add(recipe.strArea);
                    });
                    
                    // Rebuild indexes
                    recipes.forEach(recipe => {
                        this.categoryRecipes.get(recipe.strCategory).add(recipe.idMeal);
                        this.areaRecipes.get(recipe.strArea).add(recipe.idMeal);
                    });
                }
                
                // Load categories
                const categoriesData = localStorage.getItem('categories');
                if (categoriesData) {
                    const categories = JSON.parse(categoriesData);
                    categories.forEach(category => this.categories.add(category));
                }
                
                // Load areas
                const areasData = localStorage.getItem('areas');
                if (areasData) {
                    const areas = JSON.parse(areasData);
                    areas.forEach(area => this.areas.add(area));
                }
                
                // Load messages
                const messagesData = localStorage.getItem('messages');
                if (messagesData) {
                    this.messages = JSON.parse(messagesData);
                }
            }

            // Save data to localStorage
            saveData() {
                // Save recipes
                const recipes = Array.from(this.recipes.values());
                localStorage.setItem('recipes', JSON.stringify(recipes));
                
                // Save categories
                const categories = Array.from(this.categories);
                localStorage.setItem('categories', JSON.stringify(categories));
                
                // Save areas
                const areas = Array.from(this.areas);
                localStorage.setItem('areas', JSON.stringify(areas));
                
                // Save messages
                localStorage.setItem('messages', JSON.stringify(this.messages));
            }

            // Initialize with sample data
            initializeSampleData() {
                // Add sample categories
                const sampleCategories = ['Breakfast', 'Lunch', 'Dinner', 'Dessert', 'Snack'];
                sampleCategories.forEach(category => this.categories.add(category));
                
                // Add sample areas
                const sampleAreas = ['Indian', 'Italian', 'Chinese', 'Mexican', 'American'];
                sampleAreas.forEach(area => this.areas.add(area));
                
                // Add sample recipes
                const sampleRecipes = [
                    {
                        idMeal: '1',
                        strMeal: 'Chicken Tikka Masala',
                        strCategory: 'Dinner',
                        strArea: 'Indian',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/syt7q41615552591.jpg',
                        strInstructions: 'Mix chicken with yogurt and spices. Marinate for 2 hours. Grill chicken until cooked. Prepare sauce with tomatoes, cream, and spices. Add grilled chicken to sauce. Simmer for 15 minutes. Serve with rice or naan.',
                        ingredients: [
                            { name: 'Chicken', measure: '500g' },
                            { name: 'Yogurt', measure: '1 cup' },
                            { name: 'Tomatoes', measure: '400g' },
                            { name: 'Cream', measure: '200ml' },
                            { name: 'Garam Masala', measure: '2 tsp' },
                            { name: 'Ginger', measure: '1 inch' },
                            { name: 'Garlic', measure: '4 cloves' }
                        ],
                        nutrition: {
                            calories: 350,
                            protein: 30,
                            carbs: 15,
                            fat: 20
                        }
                    },
                    {
                        idMeal: '2',
                        strMeal: 'Spaghetti Carbonara',
                        strCategory: 'Dinner',
                        strArea: 'Italian',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/llcbn01574260722.jpg',
                        strInstructions: 'Cook spaghetti according to package directions. In a large skillet, cook pancetta until crispy. In a bowl, whisk eggs and cheese. Drain pasta and add to skillet with pancetta. Remove from heat and add egg mixture, tossing quickly. Season with pepper and serve immediately.',
                        ingredients: [
                            { name: 'Spaghetti', measure: '400g' },
                            { name: 'Pancetta', measure: '200g' },
                            { name: 'Eggs', measure: '4' },
                            { name: 'Parmesan', measure: '100g' },
                            { name: 'Black Pepper', measure: '1 tsp' }
                        ],
                        nutrition: {
                            calories: 420,
                            protein: 25,
                            carbs: 45,
                            fat: 18
                        }
                    },
                    {
                        idMeal: '3',
                        strMeal: 'Sweet and Sour Pork',
                        strCategory: 'Dinner',
                        strArea: 'Chinese',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/1529444113.jpg',
                        strInstructions: 'Cut pork into bite-sized pieces and marinate. Coat with cornstarch and fry until golden. In a wok, stir-fry vegetables. Add sauce ingredients and bring to a boil. Add fried pork and toss to coat. Serve with rice.',
                        ingredients: [
                            { name: 'Pork', measure: '500g' },
                            { name: 'Pineapple', measure: '1 cup' },
                            { name: 'Bell Pepper', measure: '1' },
                            { name: 'Vinegar', measure: '3 tbsp' },
                            { name: 'Sugar', measure: '3 tbsp' },
                            { name: 'Soy Sauce', measure: '2 tbsp' }
                        ],
                        nutrition: {
                            calories: 380,
                            protein: 28,
                            carbs: 35,
                            fat: 15
                        }
                    },
                    {
                        idMeal: '4',
                        strMeal: 'Chicken Tacos',
                        strCategory: 'Dinner',
                        strArea: 'Mexican',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/tyysvw1504629464.jpg',
                        strInstructions: 'Season chicken with spices and grill until cooked. Slice into strips. Warm tortillas. Fill tortillas with chicken, salsa, cheese, and toppings. Serve with lime wedges.',
                        ingredients: [
                            { name: 'Chicken', measure: '500g' },
                            { name: 'Tortillas', measure: '8' },
                            { name: 'Cheese', measure: '200g' },
                            { name: 'Lettuce', measure: '1 head' },
                            { name: 'Tomatoes', measure: '2' },
                            { name: 'Sour Cream', measure: '200ml' }
                        ],
                        nutrition: {
                            calories: 320,
                            protein: 30,
                            carbs: 25,
                            fat: 12
                        }
                    },
                    {
                        idMeal: '5',
                        strMeal: 'Classic Burger',
                        strCategory: 'Dinner',
                        strArea: 'American',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/uyuyrr1511382809.jpg',
                        strInstructions: 'Form ground beef into patties and season with salt and pepper. Grill or pan-fry until cooked through. Toast buns. Assemble burgers with patties, cheese, lettuce, tomato, and condiments. Serve with fries.',
                        ingredients: [
                            { name: 'Ground Beef', measure: '500g' },
                            { name: 'Burger Buns', measure: '4' },
                            { name: 'Cheese', measure: '4 slices' },
                            { name: 'Lettuce', measure: '4 leaves' },
                            { name: 'Tomato', measure: '1' },
                            { name: 'Onion', measure: '1' }
                        ],
                        nutrition: {
                            calories: 450,
                            protein: 30,
                            carbs: 30,
                            fat: 22
                        }
                    },
                    {
                        idMeal: '6',
                        strMeal: 'Paneer Butter Masala',
                        strCategory: 'Dinner',
                        strArea: 'Indian',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/vptpxx1511297858.jpg',
                        strInstructions: 'Cut paneer into cubes and fry until golden. In a pan, heat butter and sautÃ© onions, ginger, and garlic. Add tomatoes and spices, cook until thick. Add cream and fried paneer. Simmer for 10 minutes. Garnish with coriander and serve with naan or rice.',
                        ingredients: [
                            { name: 'Paneer', measure: '400g' },
                            { name: 'Butter', measure: '4 tbsp' },
                            { name: 'Onion', measure: '2' },
                            { name: 'Tomatoes', measure: '4' },
                            { name: 'Cream', measure: '200ml' },
                            { name: 'Garam Masala', measure: '2 tsp' }
                        ],
                        nutrition: {
                            calories: 380,
                            protein: 18,
                            carbs: 12,
                            fat: 28
                        }
                    },
                    {
                        idMeal: '7',
                        strMeal: 'Margherita Pizza',
                        strCategory: 'Dinner',
                        strArea: 'Italian',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/0jv5hx1511456739.jpg',
                        strInstructions: 'Roll out pizza dough and place on a baking sheet. Spread tomato sauce evenly. Add mozzarella cheese and tomato slices. Drizzle with olive oil and season with salt and pepper. Bake at 220Â°C for 12-15 minutes until crust is golden. Garnish with fresh basil.',
                        ingredients: [
                            { name: 'Pizza Dough', measure: '1' },
                            { name: 'Tomato Sauce', measure: '200ml' },
                            { name: 'Mozzarella', measure: '200g' },
                            { name: 'Tomatoes', measure: '2' },
                            { name: 'Basil', measure: 'few leaves' },
                            { name: 'Olive Oil', measure: '2 tbsp' }
                        ],
                        nutrition: {
                            calories: 280,
                            protein: 12,
                            carbs: 35,
                            fat: 10
                        }
                    },
                    {
                        idMeal: '8',
                        strMeal: 'Fried Rice',
                        strCategory: 'Dinner',
                        strArea: 'Chinese',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/1529445434.jpg',
                        strInstructions: 'Heat oil in a wok and scramble eggs. Add diced vegetables and stir-fry for 2-3 minutes. Add cooked rice and stir-fry for 3-4 minutes. Add soy sauce, oyster sauce, and white pepper. Mix well and serve hot.',
                        ingredients: [
                            { name: 'Cooked Rice', measure: '3 cups' },
                            { name: 'Eggs', measure: '2' },
                            { name: 'Carrots', measure: '1' },
                            { name: 'Peas', measure: '1/2 cup' },
                            { name: 'Soy Sauce', measure: '3 tbsp' },
                            { name: 'Spring Onions', measure: '2' }
                        ],
                        nutrition: {
                            calories: 320,
                            protein: 10,
                            carbs: 50,
                            fat: 8
                        }
                    },
                    {
                        idMeal: '9',
                        strMeal: 'Quesadilla',
                        strCategory: 'Lunch',
                        strArea: 'Mexican',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/qxtywq1505931186.jpg',
                        strInstructions: 'Place a tortilla in a pan over medium heat. Sprinkle cheese and add fillings on one half. Fold the tortilla in half and cook until golden on both sides. Cut into wedges and serve with salsa and sour cream.',
                        ingredients: [
                            { name: 'Tortillas', measure: '4' },
                            { name: 'Cheese', measure: '200g' },
                            { name: 'Chicken', measure: '200g' },
                            { name: 'Bell Peppers', measure: '1' },
                            { name: 'Onion', measure: '1' },
                            { name: 'Sour Cream', measure: '100ml' }
                        ],
                        nutrition: {
                            calories: 350,
                            protein: 25,
                            carbs: 30,
                            fat: 15
                        }
                    },
                    {
                        idMeal: '10',
                        strMeal: 'Pancakes',
                        strCategory: 'Breakfast',
                        strArea: 'American',
                        strMealThumb: 'https://www.themealdb.com/images/media/meals/rwuyqx1511383174.jpg',
                        strInstructions: 'Mix flour, sugar, baking powder, and salt. In another bowl, whisk milk, egg, and melted butter. Combine wet and dry ingredients until just mixed. Pour batter onto a hot griddle and cook until bubbles form. Flip and cook until golden. Serve with maple syrup and butter.',
                        ingredients: [
                            { name: 'Flour', measure: '2 cups' },
                            { name: 'Milk', measure: '1.5 cups' },
                            { name: 'Eggs', measure: '2' },
                            { name: 'Butter', measure: '3 tbsp' },
                            { name: 'Sugar', measure: '2 tbsp' },
                            { name: 'Baking Powder', measure: '2 tsp' }
                        ],
                        nutrition: {
                            calories: 220,
                            protein: 8,
                            carbs: 35,
                            fat: 6
                        }
                    }
                ];
                
                // Add sample recipes to data manager
                sampleRecipes.forEach(recipe => {
                    this.addRecipe(recipe);
                });
                
                // Save data to localStorage
                this.saveData();
            }

            // Store recipe details
            addRecipe(recipe) {
                this.recipes.set(recipe.idMeal, recipe);
                
                // Update indexes
                if (!this.categoryRecipes.has(recipe.strCategory)) {
                    this.categoryRecipes.set(recipe.strCategory, new Set());
                }
                this.categoryRecipes.get(recipe.strCategory).add(recipe.idMeal);
                
                if (!this.areaRecipes.has(recipe.strArea)) {
                    this.areaRecipes.set(recipe.strArea, new Set());
                }
                this.areaRecipes.get(recipe.strArea).add(recipe.idMeal);
                
                this.categories.add(recipe.strCategory);
                this.areas.add(recipe.strArea);
                
                // Save to localStorage
                this.saveData();
            }

            // Get recipe details
            getRecipe(id) {
                return this.recipes.get(id);
            }

            // Get all recipes
            getAllRecipes() {
                return Array.from(this.recipes.values());
            }

            // Add recipe to category index
            addRecipeToCategory(category, recipeId) {
                if (!this.categoryRecipes.has(category)) {
                    this.categoryRecipes.set(category, new Set());
                }
                this.categoryRecipes.get(category).add(recipeId);
            }

            // Add recipe to area index
            addRecipeToArea(area, recipeId) {
                if (!this.areaRecipes.has(area)) {
                    this.areaRecipes.set(area, new Set());
                }
                this.areaRecipes.get(area).add(recipeId);
            }

            // Find intersection of category and area recipes using Set operations
            findIntersection(category, area) {
                const categoryIds = this.categoryRecipes.get(category) || new Set();
                const areaIds = this.areaRecipes.get(area) || new Set();
                
                // Efficient intersection using Set
                const intersection = [...categoryIds].filter(id => areaIds.has(id));
                
                // Convert to recipe objects
                return intersection.map(id => this.recipes.get(id)).filter(Boolean);
            }

            // Get recipes from category
            getCategoryRecipes(category) {
                const categoryIds = this.categoryRecipes.get(category) || new Set();
                return [...categoryIds].map(id => this.recipes.get(id)).filter(Boolean);
            }

            // Get recipes from area
            getAreaRecipes(area) {
                const areaIds = this.areaRecipes.get(area) || new Set();
                return [...areaIds].map(id => this.recipes.get(id)).filter(Boolean);
            }

            // Get all categories
            getCategories() {
                return Array.from(this.categories);
            }

            // Get all areas
            getAreas() {
                return Array.from(this.areas);
            }

            // Add category
            addCategory(category) {
                this.categories.add(category);
                this.saveData();
            }

            // Add area
            addArea(area) {
                this.areas.add(area);
                this.saveData();
            }

            // Delete recipe
            deleteRecipe(id) {
                const recipe = this.recipes.get(id);
                if (!recipe) return false;
                
                // Remove from recipes
                this.recipes.delete(id);
                
                // Remove from category index
                if (this.categoryRecipes.has(recipe.strCategory)) {
                    this.categoryRecipes.get(recipe.strCategory).delete(id);
                }
                
                // Remove from area index
                if (this.areaRecipes.has(recipe.strArea)) {
                    this.areaRecipes.get(recipe.strArea).delete(id);
                }
                
                // Save to localStorage
                this.saveData();
                
                return true;
            }

            // Add message
            addMessage(title, content) {
                const message = {
                    id: Date.now().toString(),
                    title,
                    content,
                    date: new Date().toISOString()
                };
                
                this.messages.push(message);
                this.saveData();
                
                return message;
            }

            // Get messages
            getMessages() {
                return this.messages;
            }

            // Delete message
            deleteMessage(id) {
                const index = this.messages.findIndex(msg => msg.id === id);
                if (index !== -1) {
                    this.messages.splice(index, 1);
                    this.saveData();
                    return true;
                }
                return false;
            }
        }

        // Lazy Loading for images
        class ImageLoader {
            constructor() {
                this.imageObserver = null;
                this.init();
            }

            init() {
                // Create an Intersection Observer to detect when images enter viewport
                this.imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            const src = img.dataset.src;
                            
                            if (src) {
                                img.src = src;
                                img.classList.add('loaded');
                                observer.unobserve(img);
                            }
                        }
                    });
                }, {
                    rootMargin: '50px 0px', // Start loading 50px before image is in viewport
                    threshold: 0.01
                });
            }

            observe(img) {
                if (this.imageObserver) {
                    this.imageObserver.observe(img);
                }
            }

            disconnect() {
                if (this.imageObserver) {
                    this.imageObserver.disconnect();
                }
            }
        }

        // DOM Elements for Authentication
        const userTypeCard = document.getElementById('userTypeCard');
        const adminTypeCard = document.getElementById('adminTypeCard');
        const signinTab = document.getElementById('signinTab');
        const registerTab = document.getElementById('registerTab');
        const signinForm = document.getElementById('signinForm');
        const registerForm = document.getElementById('registerForm');
        const authFooterText = document.getElementById('authFooterText');
        const authFooterLink = document.getElementById('authFooterLink');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const returnBtn = document.getElementById('returnBtn');

        // DOM Elements for Main App
        const categorySelect = document.getElementById('categorySelect');
        const areaSelect = document.getElementById('areaSelect');
        const categoryOriginal = document.getElementById('category');
        const areaOriginal = document.getElementById('area');
        const searchForm = document.getElementById('searchForm');
        const searchBtn = document.getElementById('searchBtn');
        const loading = document.getElementById('loading');
        const resultsSection = document.getElementById('resultsSection');
        const recipeGrid = document.getElementById('recipeGrid');
        const resultsCount = document.getElementById('resultsCount');
        const suggestionNote = document.getElementById('suggestionNote');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');

        // DOM Elements for Admin App
        const adminTabs = document.querySelectorAll('.admin-tab');
        const recipeForm = document.getElementById('recipeForm');
        const categoryForm = document.getElementById('categoryForm');
        const areaForm = document.getElementById('areaForm');
        const messageForm = document.getElementById('messageForm');
        const addIngredientBtn = document.getElementById('addIngredientBtn');
        const ingredientsContainer = document.getElementById('ingredientsContainer');

        // DOM Elements for Header Icons
        const messageBell = document.getElementById('messageBell');
        const messageBadge = document.getElementById('messageBadge');
        const messageDropdown = document.getElementById('messageDropdown');
        const messageDropdownClose = document.getElementById('messageDropdownClose');
        const messageDropdownContent = document.getElementById('messageDropdownContent');
        
        const subscriptionBell = document.getElementById('subscriptionBell');
        const subscriptionDropdown = document.getElementById('subscriptionDropdown');
        const subscriptionDropdownClose = document.getElementById('subscriptionDropdownClose');

        // DOM Elements for Recipe Modal
        const recipeModal = document.getElementById('recipeModal');
        const modalClose = document.getElementById('modalClose');
        const modalRecipeImage = document.getElementById('modalRecipeImage');
        const modalRecipeTitle = document.getElementById('modalRecipeTitle');
        const modalRecipeCategory = document.getElementById('modalRecipeCategory');
        const modalRecipeArea = document.getElementById('modalRecipeArea');
        const modalCaloriesValue = document.getElementById('modalCaloriesValue');
        const modalProteinValue = document.getElementById('modalProteinValue');
        const modalCarbsValue = document.getElementById('modalCarbsValue');
        const modalFatValue = document.getElementById('modalFatValue');
        const modalNutritionSummary = document.getElementById('modalNutritionSummary');
        const modalIngredientsList = document.getElementById('modalIngredientsList');
        const modalInstructionsList = document.getElementById('modalInstructionsList');

        // Initialize services and managers
        const authManager = new AuthManager();
        const dataManager = new DataManager();
        const imageLoader = new ImageLoader();
        const nutritionCalculator = new NutritionCalculator();

        // Store all areas for fusion functionality
        let allAreas = [];

        // Authentication Event Listeners
        userTypeCard.addEventListener('click', () => {
            userTypeCard.classList.add('active');
            adminTypeCard.classList.remove('active');
            authManager.authType = 'user';
            returnBtn.style.display = 'none';
        });

        adminTypeCard.addEventListener('click', () => {
            adminTypeCard.classList.add('active');
            userTypeCard.classList.remove('active');
            authManager.authType = 'admin';
            returnBtn.style.display = 'flex';
        });

        signinTab.addEventListener('click', () => {
            signinTab.classList.add('active');
            registerTab.classList.remove('active');
            signinForm.classList.add('active');
            registerForm.classList.remove('active');
            authFooterText.innerHTML = 'Don\'t have an account? <a href="#" id="authFooterLink">Register</a>';
            document.getElementById('authFooterLink').addEventListener('click', (e) => {
                e.preventDefault();
                registerTab.click();
            });
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            signinTab.classList.remove('active');
            registerForm.classList.add('active');
            signinForm.classList.remove('active');
            authFooterText.innerHTML = 'Already have an account? <a href="#" id="authFooterLink">Sign In</a>';
            document.getElementById('authFooterLink').addEventListener('click', (e) => {
                e.preventDefault();
                signinTab.click();
            });
        });

        authFooterLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerTab.click();
        });

        // Return button
        returnBtn.addEventListener('click', () => {
            userTypeCard.classList.add('active');
            adminTypeCard.classList.remove('active');
            authManager.authType = 'user';
            returnBtn.style.display = 'none';
        });

        // Sign In Form Submission
        signinForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;
            
            // Reset errors
            document.querySelectorAll('.form-error').forEach(error => {
                error.classList.remove('show');
            });
            
            // Validate
            let isValid = true;
            
            if (!email) {
                document.getElementById('signinEmailError').classList.add('show');
                isValid = false;
            }
            
            if (!password) {
                document.getElementById('signinPasswordError').classList.add('show');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Attempt sign in
            let result;
            if (authManager.authType === 'user') {
                result = authManager.signin(email, password);
                if (result.success) {
                    showNotification(result.message, 'success');
                    authManager.showMainApp();
                    loadCategories();
                    loadAreas();
                    loadUserMessages();
                } else {
                    showNotification(result.message, 'error');
                }
            } else {
                result = authManager.signinAdmin(email, password);
                if (result.success) {
                    showNotification(result.message, 'success');
                    authManager.showAdminApp();
                    loadAdminData();
                } else {
                    showNotification(result.message, 'error');
                }
            }
        });

        // Register Form Submission
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Reset errors
            document.querySelectorAll('.form-error').forEach(error => {
                error.classList.remove('show');
            });
            
            // Validate
            let isValid = true;
            
            if (!name) {
                document.getElementById('registerNameError').classList.add('show');
                isValid = false;
            }
            
            if (!email) {
                document.getElementById('registerEmailError').classList.add('show');
                isValid = false;
            }
            
            if (!password || password.length < 6) {
                document.getElementById('registerPasswordError').classList.add('show');
                isValid = false;
            }
            
            if (password !== confirmPassword) {
                document.getElementById('confirmPasswordError').classList.add('show');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Attempt registration
            let result;
            if (authManager.authType === 'user') {
                result = authManager.register(name, email, password);
                if (result.success) {
                    showNotification(result.message, 'success');
                    // Auto sign in after successful registration
                    authManager.signin(email, password);
                    authManager.showMainApp();
                    loadCategories();
                    loadAreas();
                    loadUserMessages();
                } else {
                    showNotification(result.message, 'error');
                }
            } else {
                result = authManager.registerAdmin(name, email, password);
                if (result.success) {
                    showNotification(result.message, 'success');
                    // Auto sign in after successful registration
                    authManager.signinAdmin(email, password);
                    authManager.showAdminApp();
                    loadAdminData();
                } else {
                    showNotification(result.message, 'error');
                }
            }
        });

        // Logout Button
        logoutBtn.addEventListener('click', () => {
            authManager.logout();
            showNotification('You have been logged out', 'info');
        });

        // Admin Logout Button
        adminLogoutBtn.addEventListener('click', () => {
            authManager.logoutAdmin();
            showNotification('You have been logged out', 'info');
        });

        // Header Icon Functionality
        messageBell.addEventListener('click', () => {
            messageDropdown.classList.toggle('show');
            subscriptionDropdown.classList.remove('show');
        });

        messageDropdownClose.addEventListener('click', () => {
            messageDropdown.classList.remove('show');
        });

        subscriptionBell.addEventListener('click', () => {
            subscriptionDropdown.classList.toggle('show');
            messageDropdown.classList.remove('show');
        });

        subscriptionDropdownClose.addEventListener('click', () => {
            subscriptionDropdown.classList.remove('show');
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!messageBell.contains(e.target)) {
                messageDropdown.classList.remove('show');
            }
            if (!subscriptionBell.contains(e.target)) {
                subscriptionDropdown.classList.remove('show');
            }
        });

        // Recipe Modal Functionality
        modalClose.addEventListener('click', () => {
            recipeModal.classList.remove('show');
        });

        recipeModal.addEventListener('click', (e) => {
            if (e.target === recipeModal) {
                recipeModal.classList.remove('show');
            }
        });

        // Load user messages into dropdown
        function loadUserMessages() {
            const messages = dataManager.getMessages();
            
            if (messages.length === 0) {
                messageDropdownContent.innerHTML = '<div class="dropdown-empty">No messages at this time.</div>';
                messageBadge.style.display = 'none';
                return;
            }
            
            // Update badge
            messageBadge.textContent = messages.length;
            messageBadge.style.display = 'flex';
            
            // Clear previous messages
            messageDropdownContent.innerHTML = '';
            
            // Add messages
            messages.forEach(message => {
                const messageItem = document.createElement('div');
                messageItem.className = 'dropdown-item';
                
                const date = new Date(message.date);
                const formattedDate = date.toLocaleDateString();
                
                messageItem.innerHTML = `
                    <div class="item-title">${message.title}</div>
                    <div class="item-content">${message.content}</div>
                    <div class="item-date">${formattedDate}</div>
                `;
                
                messageDropdownContent.appendChild(messageItem);
            });
        }

        // Load admin data
        function loadAdminData() {
            // Load categories
            const categories = dataManager.getCategories();
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.innerHTML = `
                    <i class="fas fa-tag"></i>
                    <span>${category}</span>
                `;
                categoryList.appendChild(categoryItem);
            });
            
            // Load areas
            const areas = dataManager.getAreas();
            const areaList = document.getElementById('areaList');
            areaList.innerHTML = '';
            
            areas.forEach(area => {
                const areaItem = document.createElement('div');
                areaItem.className = 'area-item';
                areaItem.innerHTML = `
                    <i class="fas fa-globe"></i>
                    <span>${area}</span>
                `;
                areaList.appendChild(areaItem);
            });
            
            // Load recipes
            loadRecipesList();
            
            // Load messages
            loadMessagesList();
            
            // Update category and area dropdowns in recipe form
            updateRecipeFormDropdowns();
        }

        // Update recipe form dropdowns
        function updateRecipeFormDropdowns() {
            const recipeCategory = document.getElementById('recipeCategory');
            const recipeArea = document.getElementById('recipeArea');
            
            // Clear existing options
            recipeCategory.innerHTML = '<option value="">Select a category</option>';
            recipeArea.innerHTML = '<option value="">Select a cuisine</option>';
            
            // Add categories
            const categories = dataManager.getCategories();
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                recipeCategory.appendChild(option);
            });
            
            // Add areas
            const areas = dataManager.getAreas();
            areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                recipeArea.appendChild(option);
            });
        }

        // Load recipes list
        function loadRecipesList() {
            const recipes = dataManager.getAllRecipes();
            const recipesList = document.getElementById('recipesList');
            
            if (recipes.length === 0) {
                recipesList.innerHTML = '<p>No recipes added yet.</p>';
                return;
            }
            
            recipesList.innerHTML = '';
            recipes.forEach(recipe => {
                const recipeItem = document.createElement('div');
                recipeItem.className = 'recipe-card';
                recipeItem.style.marginBottom = '1rem';
                
                recipeItem.innerHTML = `
                    <div class="recipe-content">
                        <h3 class="recipe-title">${recipe.strMeal}</h3>
                        <div class="recipe-meta">
                            <div class="recipe-category">
                                <i class="fas fa-tag"></i>
                                ${recipe.strCategory}
                            </div>
                            <div class="recipe-area">
                                <i class="fas fa-globe"></i>
                                ${recipe.strArea}
                            </div>
                        </div>
                        <button class="btn-delete" data-id="${recipe.idMeal}">Delete</button>
                    </div>
                `;
                
                recipesList.appendChild(recipeItem);
            });
            
            // Add delete event listeners
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this recipe?')) {
                        dataManager.deleteRecipe(id);
                        loadRecipesList();
                        showNotification('Recipe deleted successfully', 'success');
                    }
                });
            });
        }

        // Load messages list
        function loadMessagesList() {
            const messages = dataManager.getMessages();
            const messageList = document.getElementById('messageList');
            
            if (messages.length === 0) {
                messageList.innerHTML = '<p>No messages sent yet.</p>';
                return;
            }
            
            messageList.innerHTML = '';
            messages.forEach(message => {
                const messageItem = document.createElement('div');
                messageItem.className = 'message-item';
                
                const date = new Date(message.date);
                const formattedDate = date.toLocaleDateString();
                
                messageItem.innerHTML = `
                    <div class="message-content">
                        <div class="message-title">${message.title}</div>
                        <div class="message-text">${message.content}</div>
                    </div>
                    <div class="message-date">${formattedDate}</div>
                    <button class="btn-delete" data-id="${message.id}">Delete</button>
                `;
                
                messageList.appendChild(messageItem);
            });
            
            // Add delete event listeners
            document.querySelectorAll('.message-item .btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this message?')) {
                        dataManager.deleteMessage(id);
                        loadMessagesList();
                        showNotification('Message deleted successfully', 'success');
                    }
                });
            });
        }

        // Admin tabs
        adminTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                
                // Update active tab
                adminTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update active content
                document.querySelectorAll('.admin-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // Add ingredient button
        addIngredientBtn.addEventListener('click', () => {
            const ingredientRow = document.createElement('div');
            ingredientRow.className = 'ingredient-row';
            ingredientRow.innerHTML = `
                <input type="text" class="form-control ingredient-name" placeholder="Ingredient name">
                <input type="text" class="form-control ingredient-measure" placeholder="Measure">
                <button type="button" class="btn-remove"><i class="fas fa-times"></i></button>
            `;
            
            ingredientsContainer.appendChild(ingredientRow);
            
            // Add remove event listener
            ingredientRow.querySelector('.btn-remove').addEventListener('click', function() {
                ingredientRow.remove();
            });
        });

        // Recipe form submission
        recipeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const area = document.getElementById('recipeArea').value;
            const image = document.getElementById('recipeImage').value;
            const instructions = document.getElementById('recipeInstructions').value;
            const calories = document.getElementById('recipeCalories').value;
            const protein = document.getElementById('recipeProtein').value;
            const carbs = document.getElementById('recipeCarbs').value;
            const fat = document.getElementById('recipeFat').value;
            
            // Get ingredients
            const ingredientRows = ingredientsContainer.querySelectorAll('.ingredient-row');
            const ingredients = [];
            
            ingredientRows.forEach(row => {
                const name = row.querySelector('.ingredient-name').value;
                const measure = row.querySelector('.ingredient-measure').value;
                
                if (name && measure) {
                    ingredients.push({ name, measure });
                }
            });
            
            // Create recipe object
            const recipe = {
                idMeal: Date.now().toString(),
                strMeal: name,
                strCategory: category,
                strArea: area,
                strMealThumb: image || `https://picsum.photos/seed/${name}/400/300.jpg`,
                strInstructions: instructions,
                ingredients: ingredients,
                nutrition: {
                    calories: parseInt(calories) || 0,
                    protein: parseInt(protein) || 0,
                    carbs: parseInt(carbs) || 0,
                    fat: parseInt(fat) || 0
                }
            };
            
            // Add recipe to data manager
            dataManager.addRecipe(recipe);
            
            // Reset form
            recipeForm.reset();
            
            // Reload recipes list
            loadRecipesList();
            
            showNotification('Recipe added successfully', 'success');
        });

        // Category form submission
        categoryForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const category = document.getElementById('newCategory').value;
            
            if (category) {
                dataManager.addCategory(category);
                
                // Reset form
                categoryForm.reset();
                
                // Reload categories list
                loadAdminData();
                
                showNotification('Category added successfully', 'success');
            }
        });

        // Area form submission
        areaForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const area = document.getElementById('newArea').value;
            
            if (area) {
                dataManager.addArea(area);
                
                // Reset form
                areaForm.reset();
                
                // Reload areas list
                loadAdminData();
                
                showNotification('Cuisine added successfully', 'success');
            }
        });

        // Message form submission
        messageForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const title = document.getElementById('messageTitle').value;
            const content = document.getElementById('messageContent').value;
            
            if (title && content) {
                dataManager.addMessage(title, content);
                
                // Reset form
                messageForm.reset();
                
                // Reload messages list
                loadMessagesList();
                
                showNotification('Message sent successfully', 'success');
            }
        });

        // Setup custom select functionality
        function setupCustomSelects() {
            // Category select
            const categoryTrigger = categorySelect.querySelector('.select-trigger');
            
            categoryTrigger.addEventListener('click', () => {
                categorySelect.classList.toggle('open');
                // Close other select
                areaSelect.classList.remove('open');
            });
            
            // Area select
            const areaTrigger = areaSelect.querySelector('.select-trigger');
            
            areaTrigger.addEventListener('click', () => {
                areaSelect.classList.toggle('open');
                // Close other select
                categorySelect.classList.remove('open');
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!categorySelect.contains(e.target)) {
                    categorySelect.classList.remove('open');
                }
                if (!areaSelect.contains(e.target)) {
                    areaSelect.classList.remove('open');
                }
            });
            
            // Handle option selection
            document.querySelectorAll('.select-option').forEach(option => {
                option.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const text = this.textContent.replace('â˜…', '').trim();
                    const select = this.closest('.custom-select');
                    const trigger = select.querySelector('.select-trigger span');
                    const originalSelect = select.querySelector('select');
                    
                    // Update trigger text
                    trigger.textContent = text;
                    
                    // Update original select value
                    originalSelect.value = value;
                    
                    // Mark selected option
                    const options = select.querySelectorAll('.select-option');
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Close dropdown
                    select.classList.remove('open');
                });
            });
        }

        // Load recipe categories
        function loadCategories() {
            const categories = dataManager.getCategories();
            
            const categoryOptions = categorySelect.querySelector('.select-options');
            
            categories.forEach(category => {
                // Add to original select
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryOriginal.appendChild(option);
                
                // Add to custom select
                const customOption = document.createElement('div');
                customOption.className = 'select-option';
                customOption.setAttribute('data-value', category);
                customOption.textContent = category;
                categoryOptions.appendChild(customOption);
                
                // Add click event
                customOption.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const text = this.textContent.replace('â˜…', '').trim();
                    const trigger = categorySelect.querySelector('.select-trigger span');
                    
                    // Update trigger text
                    trigger.textContent = text;
                    
                    // Update original select value
                    categoryOriginal.value = value;
                    
                    // Mark selected option
                    const options = categorySelect.querySelectorAll('.select-option');
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Close dropdown
                    categorySelect.classList.remove('open');
                });
            });
            
            // Setup custom selects after loading options
            setupCustomSelects();
        }

        // Load cuisine areas
        function loadAreas() {
            const areas = dataManager.getAreas();
            
            const areaOptions = areaSelect.querySelector('.select-options');
            
            // Store all areas for fusion functionality
            allAreas = areas;
            
            areas.forEach(area => {
                // Add to original select
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                areaOriginal.appendChild(option);
                
                // Add to custom select (before the fusion option)
                const customOption = document.createElement('div');
                customOption.className = 'select-option';
                customOption.setAttribute('data-value', area);
                customOption.textContent = area;
                
                // Insert before the fusion option
                const fusionOption = areaOptions.querySelector('.fusion-option');
                areaOptions.insertBefore(customOption, fusionOption);
                
                // Add click event
                customOption.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const text = this.textContent.replace('â˜…', '').trim();
                    const trigger = areaSelect.querySelector('.select-trigger span');
                    
                    // Update trigger text
                    trigger.textContent = text;
                    
                    // Update original select value
                    areaOriginal.value = value;
                    
                    // Mark selected option
                    const options = areaSelect.querySelectorAll('.select-option');
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Close dropdown
                    areaSelect.classList.remove('open');
                });
            });
            
            // Add click event for fusion option
            const fusionOption = areaOptions.querySelector('.fusion-option');
            fusionOption.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                const text = this.textContent.replace('â˜…', '').trim();
                const trigger = areaSelect.querySelector('.select-trigger span');
                
                // Update trigger text
                trigger.textContent = text;
                
                // Update original select value
                areaOriginal.value = value;
                
                // Mark selected option
                const options = areaSelect.querySelectorAll('.select-option');
                options.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                
                // Close dropdown
                areaSelect.classList.remove('open');
            });
        }

        // Handle form submission
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const category = categoryOriginal.value;
            const area = areaOriginal.value;
            
            if (!category || !area) {
                showNotification('Please select both a category and a cuisine', 'error');
                return;
            }
            
            await findFusionRecipes(category, area);
        });

        // Find fusion recipes
        async function findFusionRecipes(category, area) {
            // Show loading state
            loading.classList.add('active');
            resultsSection.style.display = 'none';
            searchBtn.disabled = true;
            
            try {
                let fusionRecipes = [];
                let isSuggested = false;
                
                if (area === 'fusion') {
                    // For fusion, get recipes from multiple cuisines
                    const selectedAreas = getRandomAreas(3); // Get 3 random areas for fusion
                    
                    // Get recipes from all areas
                    selectedAreas.forEach(selectedArea => {
                        const recipes = dataManager.getAreaRecipes(selectedArea);
                        recipes.forEach(recipe => {
                            if (recipe.strCategory === category) {
                                fusionRecipes.push({
                                    ...recipe,
                                    isFusion: true,
                                    fusionAreas: selectedAreas
                                });
                            }
                        });
                    });
                    
                    // If no recipes found, get all recipes from the category
                    if (fusionRecipes.length === 0) {
                        const categoryRecipes = dataManager.getCategoryRecipes(category);
                        categoryRecipes.forEach(recipe => {
                            fusionRecipes.push({
                                ...recipe,
                                isFusion: true,
                                fusionAreas: selectedAreas
                            });
                        });
                    }
                } else {
                    // Regular intersection of category and area
                    const intersection = dataManager.findIntersection(category, area);
                    
                    if (intersection.length > 0) {
                        // Perfect match found
                        fusionRecipes = intersection.map(meal => ({
                            ...meal,
                            isFusion: false,
                            fusionAreas: [area]
                        }));
                    } else {
                        // No intersection found - create suggested fusion
                        isSuggested = true;
                        
                        // Get recipes from both category and area
                        const categoryRecipes = dataManager.getCategoryRecipes(category);
                        const areaRecipes = dataManager.getAreaRecipes(area);
                        
                        const combinedRecipes = [];
                        
                        // Add category recipes
                        categoryRecipes.slice(0, 6).forEach(recipe => {
                            combinedRecipes.push({
                                ...recipe,
                                isSuggested: true,
                                sourceType: 'category',
                                fusionAreas: [area]
                            });
                        });
                        
                        // Add area recipes if we need more
                        if (combinedRecipes.length < 6) {
                            areaRecipes.slice(0, 6 - combinedRecipes.length).forEach(recipe => {
                                // Check if not already added
                                if (!combinedRecipes.find(r => r.idMeal === recipe.idMeal)) {
                                    combinedRecipes.push({
                                        ...recipe,
                                        isSuggested: true,
                                        sourceType: 'area',
                                        fusionAreas: [area]
                                    });
                                }
                            });
                        }
                        
                        // If still not enough, add popular recipes
                        if (combinedRecipes.length < 6) {
                            const allRecipes = dataManager.getAllRecipes();
                            allRecipes.slice(0, 6 - combinedRecipes.length).forEach(recipe => {
                                if (!combinedRecipes.find(r => r.idMeal === recipe.idMeal)) {
                                    combinedRecipes.push({
                                        ...recipe,
                                        isSuggested: true,
                                        sourceType: 'popular',
                                        fusionAreas: [area]
                                    });
                                }
                            });
                        }
                        
                        fusionRecipes = combinedRecipes;
                    }
                }
                
                // Display results
                displayResults(fusionRecipes, category, area, isSuggested);
            } catch (error) {
                showNotification('Failed to fetch recipes. Please try again.', 'error');
                console.error('Error fetching recipes:', error);
            } finally {
                // Hide loading state
                loading.classList.remove('active');
                searchBtn.disabled = false;
            }
        }

        // Get random areas for fusion
        function getRandomAreas(count) {
            const shuffled = [...allAreas].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // Display the results
        function displayResults(recipes, category, area, isSuggested = false) {
            resultsSection.style.display = 'block';
            resultsCount.textContent = `${recipes.length} recipes found`;
            
            // Show or hide suggestion note
            if (isSuggested) {
                suggestionNote.style.display = 'flex';
            } else {
                suggestionNote.style.display = 'none';
            }
            
            // Clear previous results
            recipeGrid.innerHTML = '';
            
            // Add each recipe to the grid
            recipes.forEach((recipe, index) => {
                // Check if user can view this recipe
                const canView = index < 2 || authManager.canViewRecipe();
                const recipeCard = createRecipeCard(recipe, category, area, canView);
                recipeGrid.appendChild(recipeCard);
                
                // Setup lazy loading for recipe image
                const img = recipeCard.querySelector('.recipe-image');
                if (img) {
                    imageLoader.observe(img);
                }
            });
            
            const recipeType = isSuggested ? 'suggested fusion' : (area === 'fusion' ? 'fusion' : 'recipe');
            showNotification(`Found ${recipes.length} ${recipeType}${recipes.length !== 1 ? 's' : ''}!`, 'success');
        }

        // Create a recipe card element with minimal details
        function createRecipeCard(recipe, category, area, canView = true) {
            const card = document.createElement('div');
            card.className = 'recipe-card';
            if (!canView) {
                card.classList.add('blurred');
            }
            card.dataset.recipeId = recipe.idMeal;
            
            let indicators = '';
            if (recipe.isFusion) {
                indicators = '<div class="fusion-indicator">FUSION</div>';
            } else if (recipe.isSuggested) {
                indicators = '<div class="suggested-indicator">SUGGESTED</div>';
            }
            
            let areaDisplay = area === 'fusion' ? 'Multi-Cuisine' : area;
            if (recipe.sourceType === 'category') {
                areaDisplay = `${area} (from ${category})`;
            } else if (recipe.sourceType === 'area') {
                areaDisplay = `${area} cuisine`;
            } else if (recipe.sourceType === 'popular') {
                areaDisplay = 'Popular choice';
            }
            
            card.innerHTML = `
                <div class="recipe-image-container">
                    <div class="image-placeholder">
                        <i class="fas fa-image"></i>
                    </div>
                    <img src="${recipe.strMealThumb}" alt="${recipe.strMeal}" class="recipe-image" data-src="${recipe.strMealThumb}">
                    ${indicators}
                </div>
                <div class="recipe-content">
                    <h3 class="recipe-title">${recipe.strMeal}</h3>
                    <div class="recipe-meta">
                        <div class="recipe-category">
                            <i class="fas fa-tag"></i>
                            ${category}
                        </div>
                        <div class="recipe-area">
                            <i class="fas fa-globe"></i>
                            ${areaDisplay}
                        </div>
                    </div>
                </div>
            `;
            
            // Add click event to open modal
            if (canView) {
                card.addEventListener('click', () => {
                    openRecipeModal(recipe, category, area);
                    authManager.incrementRecipeView();
                });
            }
            
            return card;
        }

        // Open recipe modal with full details
        function openRecipeModal(recipe, category, area) {
            // Set modal content
            modalRecipeImage.src = recipe.strMealThumb;
            modalRecipeTitle.textContent = recipe.strMeal;
            modalRecipeCategory.textContent = category;
            modalRecipeArea.textContent = area;
            
            // Extract ingredients for nutrition calculation
            const ingredients = recipe.ingredients ? recipe.ingredients.map(ing => ing.name) : [];
            
            // Calculate nutrition if not provided
            let nutrition = recipe.nutrition || nutritionCalculator.calculateNutrition(ingredients);
            const healthRating = nutritionCalculator.getHealthRating(nutrition);
            
            // Set nutrition values
            modalCaloriesValue.textContent = nutrition.calories;
            modalProteinValue.textContent = nutrition.protein;
            modalCarbsValue.textContent = nutrition.carbs;
            modalFatValue.textContent = nutrition.fat;
            
            // Create nutrition summary
            modalNutritionSummary.innerHTML = createNutritionSummaryHTML(nutrition, healthRating);
            
            // Create ingredients list
            modalIngredientsList.innerHTML = createIngredientsListHTML(recipe);
            
            // Create instructions list
            modalInstructionsList.innerHTML = createInstructionsListHTML(recipe);
            
            // Show modal
            recipeModal.classList.add('show');
        }

        // Create nutrition summary HTML
        function createNutritionSummaryHTML(nutrition, healthRating) {
            let healthLabel = 'Fair';
            let healthColor = '#FFC107';
            
            if (healthRating >= 80) {
                healthLabel = 'Excellent';
                healthColor = '#4CAF50';
            } else if (healthRating >= 60) {
                healthLabel = 'Good';
                healthColor = '#8BC34A';
            } else if (healthRating >= 40) {
                healthLabel = 'Moderate';
                healthColor = '#FF9800';
            } else {
                healthLabel = 'High Calorie';
                healthColor = '#F44336';
            }
            
            return `
                <h4 class="nutrition-summary-title">
                    <i class="fas fa-heartbeat"></i>
                    Nutritional Information
                    <span style="margin-left: auto; font-size: 0.9rem; color: ${healthColor};">
                        ${healthLabel} (${healthRating}/100)
                    </span>
                </h4>
                <div class="nutrition-macros">
                    <div class="macro-item calories">
                        <div class="macro-value">${nutrition.calories}</div>
                        <div class="macro-label">Calories</div>
                    </div>
                    <div class="macro-item protein">
                        <div class="macro-value">${nutrition.protein}g</div>
                        <div class="macro-label">Protein</div>
                    </div>
                    <div class="macro-item carbs">
                        <div class="macro-value">${nutrition.carbs}g</div>
                        <div class="macro-label">Carbs</div>
                    </div>
                    <div class="macro-item fat">
                        <div class="macro-value">${nutrition.fat}g</div>
                        <div class="macro-label">Fat</div>
                    </div>
                </div>
            `;
        }

        // Create ingredients list HTML
        function createIngredientsListHTML(recipe) {
            let ingredientsHTML = '<div class="ingredients-list">';
            
            if (recipe.ingredients) {
                recipe.ingredients.forEach(ingredient => {
                    ingredientsHTML += `
                        <div class="ingredient-item">
                            <i class="fas fa-check-circle"></i>
                            <span>${ingredient.measure ? ingredient.measure + ' ' : ''}${ingredient.name}</span>
                        </div>
                    `;
                });
            } else {
                // Fallback for old recipe format
                for (let i = 1; i <= 20; i++) {
                    const ingredient = recipe[`strIngredient${i}`];
                    const measure = recipe[`strMeasure${i}`];
                    
                    if (ingredient && ingredient.trim() !== '') {
                        ingredientsHTML += `
                            <div class="ingredient-item">
                                <i class="fas fa-check-circle"></i>
                                <span>${measure ? measure + ' ' : ''}${ingredient}</span>
                            </div>
                        `;
                    }
                }
            }
            
            ingredientsHTML += '</div>';
            return ingredientsHTML;
        }

        // Create instructions list HTML
        function createInstructionsListHTML(recipe) {
            if (!recipe.strInstructions) return '<p>No instructions available</p>';
            
            // Split instructions by steps (commonly by newlines or periods)
            const instructions = recipe.strInstructions.split(/\r\n|\n|\r|\.\s/).filter(step => step.trim() !== '');
            
            let instructionsHTML = '<div class="instructions-list">';
            
            instructions.forEach((instruction, index) => {
                if (instruction.trim() !== '') {
                    instructionsHTML += `
                        <div class="instruction-step">
                            ${instruction.trim() + (instruction.endsWith('.') ? '' : '.')}
                        </div>
                    `;
                }
            });
            
            instructionsHTML += '</div>';
            return instructionsHTML;
        }

        // Subscription buttons
        document.querySelectorAll('.btn-subscribe').forEach(btn => {
            btn.addEventListener('click', function() {
                const plan = this.getAttribute('data-plan');
                const price = this.getAttribute('data-price');
                const duration = parseInt(this.getAttribute('data-duration'));
                
                if (confirm(`Subscribe to ${plan} plan for â‚¹${price}?`)) {
                    const result = authManager.subscribe(plan, price, duration);
                    if (result.success) {
                        showNotification(result.message, 'success');
                    } else {
                        showNotification(result.message, 'error');
                    }
                }
            });
        });

        // Show notification
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
